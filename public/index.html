<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="js/live-graph.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/2.8.1/d3.v2.min.js" type="text/javascript"></script>
		<link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" type="text/css" />
		<script>
		
		  var ON = true;
		  var OFF = false;
		  var socket, graph, timeout;
		  
		  var resetTimer = function() {
		  	clearTimeout(timeout);
		  	timeout = setTimeout(function(){
		  		setStatus(false);
		  	}, 10000);
		  };
		  
		  var setStatus = function(status) {
		  	if(status == ON){
		  		$("h4.stream-status span").attr("class","badge badge-info").html("LIVE");
		  	}
		  	else if(status == OFF){
		  		$("h4.stream-status span").attr("class","badge").html("OFFLINE");
		  	}
		  };
		  
		  $(document).ready(function() {
		  	setStatus(OFF);
		  	socket = io.connect('/');
		  	edaGraph = new Graph({ el:"#eda", label:"EDA (" + "\u03BC"  + "S)", pad:50, size:'auto', stroke:"#2CC4FF", fill:"#B6E1F2"});
		  	motionGraph = new Graph({ el:"#motion", pad:50, size:'auto', label:"Motion", stroke:"red"});
		  	$("div.loading").fadeOut();
		  	socket.on('packet', function (data) {
		  		console.log(data);
		  		setStatus(true);
		  		resetTimer();
	  			var line = data.packets[n].payload.replace("\r\n","").split(",");
	  			var x = parseFloat( line[3] );
	  			var y = parseFloat( line[2] );
	  			var z = parseFloat( line[1] );
	  			var m = Math.sqrt(x*x + y*y + z*z);
	  			edaGraph.addPoint(parseFloat( line[line.length-1] ));
	  			motionGraph.addPoint(m);
		    	
		    	
		 	});
		 	socket.on('message', function (data) {
		 		console.log(data);
		 	});
		 	
		 	
		 });
		</script>
		<link rel="stylesheet" href="stylesheets/graph.css" type="text/css" />
	</head>
	<body>
		<div class="container-fluid">
			<div class="page-header">
				<div class="row-fluid">
					<div class="span10"><h1>OliverWS</h1></div>
					<div id="song" class="span2 pull-right"></div>
					<div class="span2 pull-right"><h4 class="stream-status">Stream is <span class="badge">OFF</span></h4></div>
				</div>
			</div>
		
			<div class="row-fluid">
				<div class="span12">
					<div class="loading" style="
					    width: 33%;
					    left: 33%;
					    top: 33%;
					    position: absolute;
					">
						<h2>Loading...</h2>
						<div class="progress progress-striped active">
						  <div class="bar" style="width: 100%;"></div>
						</div>
					</div>
					<div class="row-fluid">
						<div id="eda" style="width: 100%; height:50%;"></div>
						<div id="motion" style="width: 100%; height:25%;"></div>
					</div>
					
				</div>
			</div>
			
		</div>
		
	
	
	
	</body>
</html>